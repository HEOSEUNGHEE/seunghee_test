<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>테스트 페이지</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold mb-6">이미지 크기조절 테스트</h1>
        
        <!-- 에디터 영역 -->
        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2">에디터</label>
            <div id="editor"></div>
        </div>
        
        <!-- 페이지네이션 테스트 -->
        <div class="mb-6">
            <h2 class="text-lg font-bold mb-4">페이지네이션 테스트</h2>
            <div id="pagination" class="flex items-center space-x-2"></div>
        </div>
        
        <!-- 테스트 버튼 -->
        <div class="space-x-4">
            <button onclick="testPagination()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                페이지네이션 테스트
            </button>
            <button onclick="testImageResize()" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                이미지 크기조절 테스트
            </button>
        </div>
    </div>

    <script>
        let editor = null;
        let currentPage = 1;
        let postsPerPage = 20;
        let totalCount = 150; // 테스트용 총 게시글 수

        // 에디터 초기화
        window.onload = function() {
            editor = new toastui.Editor({
                el: document.querySelector('#editor'),
                height: '300px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                toolbarItems: [
                    ['heading', 'bold', 'italic', 'strike'],
                    ['hr', 'quote'],
                    ['ul', 'ol', 'task', 'indent', 'outdent'],
                    ['table', 'image', 'link'],
                    ['code', 'codeblock'],
                    ['scrollSync']
                ]
            });
            
            // 이미지 크기조절 기능 설정
            setupImageResize();
            
            // 초기 페이지네이션 렌더링
            testPagination();
        };

        // 페이지네이션 테스트
        function testPagination() {
            const totalPages = Math.ceil(totalCount / postsPerPage);
            renderPagination(totalPages);
        }

        // 페이지네이션 렌더링
        function renderPagination(totalPages) {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';
            
            const startIndex = (currentPage - 1) * postsPerPage + 1;
            const endIndex = Math.min(currentPage * postsPerPage, totalCount);
            
            // 항목 범위 및 총 개수 표시
            const rangeSpan = document.createElement('span');
            rangeSpan.textContent = `${startIndex} to ${endIndex} of ${totalCount}`;
            rangeSpan.className = 'text-sm text-gray-600 mr-4';
            paginationContainer.appendChild(rangeSpan);
            
            if (totalPages <= 1) return;

            // 첫 페이지 버튼
            const firstButton = document.createElement('button');
            firstButton.innerHTML = '⟪';
            firstButton.title = '첫 페이지';
            firstButton.className = `px-2 py-1 text-sm border rounded hover:bg-gray-100 ${currentPage > 1 ? '' : 'opacity-50 cursor-not-allowed'}`;
            if (currentPage > 1) {
                firstButton.onclick = () => { 
                    currentPage = 1; 
                    testPagination(); 
                };
            } else {
                firstButton.disabled = true;
            }
            paginationContainer.appendChild(firstButton);

            // 이전 페이지 버튼
            const prevButton = document.createElement('button');
            prevButton.innerHTML = '‹';
            prevButton.title = '이전 페이지';
            prevButton.className = `px-2 py-1 text-sm border rounded hover:bg-gray-100 ${currentPage > 1 ? '' : 'opacity-50 cursor-not-allowed'}`;
            if (currentPage > 1) {
                prevButton.onclick = () => { 
                    currentPage--; 
                    testPagination(); 
                };
            } else {
                prevButton.disabled = true;
            }
            paginationContainer.appendChild(prevButton);

            // 현재 페이지 / 총 페이지 표시
            const pageInfoSpan = document.createElement('span');
            pageInfoSpan.textContent = `Page ${currentPage} of ${totalPages}`;
            pageInfoSpan.className = 'px-3 py-1 text-sm text-gray-600';
            paginationContainer.appendChild(pageInfoSpan);

            // 다음 페이지 버튼
            const nextButton = document.createElement('button');
            nextButton.innerHTML = '›';
            nextButton.title = '다음 페이지';
            nextButton.className = `px-2 py-1 text-sm border rounded hover:bg-gray-100 ${currentPage < totalPages ? '' : 'opacity-50 cursor-not-allowed'}`;
            if (currentPage < totalPages) {
                nextButton.onclick = () => { 
                    currentPage++; 
                    testPagination(); 
                };
            } else {
                nextButton.disabled = true;
            }
            paginationContainer.appendChild(nextButton);

            // 마지막 페이지 버튼
            const lastButton = document.createElement('button');
            lastButton.innerHTML = '⟫';
            lastButton.title = '마지막 페이지';
            lastButton.className = `px-2 py-1 text-sm border rounded hover:bg-gray-100 ${currentPage < totalPages ? '' : 'opacity-50 cursor-not-allowed'}`;
            if (currentPage < totalPages) {
                lastButton.onclick = () => { 
                    currentPage = totalPages; 
                    testPagination(); 
                };
            } else {
                lastButton.disabled = true;
            }
            paginationContainer.appendChild(lastButton);
        }

        // 이미지 크기조절 테스트
        function testImageResize() {
            // 에디터에 테스트 이미지 추가
            editor.setMarkdown(`
# 테스트 이미지

![테스트 이미지](https://via.placeholder.com/400x300/3b82f6/ffffff?text=Test+Image)

이미지를 클릭하여 크기조절을 테스트해보세요.
            `);
            
            // 이미지 크기조절 기능 적용
            setTimeout(() => {
                applyImageResizeToAllImages();
            }, 500);
        }

        // 이미지 크기조절 기능 설정
        function setupImageResize() {
            if (!editor) return;
            
            // 에디터 초기화 시 이미지 크기조절 기능 추가
            setTimeout(() => {
                applyImageResizeToAllImages();
            }, 500);
            
            // 에디터 내용이 변경될 때마다 이미지 크기조절 기능 추가
            editor.on('change', () => {
                setTimeout(() => {
                    applyImageResizeToAllImages();
                }, 100);
            });
        }

        // 모든 이미지에 크기조절 기능 적용
        function applyImageResizeToAllImages() {
            const editorElement = document.querySelector('.toastui-editor-contents');
            if (!editorElement) return;
            
            const images = editorElement.querySelectorAll('img');
            console.log('Found images:', images.length);
            
            images.forEach((img, index) => {
                // 기존 이벤트 리스너 제거 (중복 방지)
                img.removeEventListener('mouseenter', handleImageMouseEnter);
                img.removeEventListener('mouseleave', handleImageMouseLeave);
                img.removeEventListener('click', handleImageClick);
                
                // 이미지에 크기조절 기능 추가
                img.style.cursor = 'pointer';
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                img.style.resize = 'both';
                img.style.overflow = 'auto';
                img.style.minWidth = '50px';
                img.style.minHeight = '50px';
                img.style.border = '2px dashed transparent';
                img.style.transition = 'all 0.3s ease';
                img.style.position = 'relative';
                img.style.display = 'inline-block';
                
                // 이미지 호버 시 테두리 표시
                img.addEventListener('mouseenter', handleImageMouseEnter);
                img.addEventListener('mouseleave', handleImageMouseLeave);
                
                // 이미지 클릭 시 크기조절 모드 활성화
                img.addEventListener('click', handleImageClick);
                
                console.log(`Image ${index} setup complete`);
            });
        }

        // 이미지 이벤트 핸들러 함수들
        function handleImageMouseEnter() {
            this.style.border = '2px dashed #3b82f6';
            this.style.cursor = 'pointer';
        }

        function handleImageMouseLeave() {
            if (!this.contentEditable || this.contentEditable === 'false') {
                this.style.border = '2px dashed transparent';
            }
        }

        function handleImageClick(e) {
            e.preventDefault();
            e.stopPropagation();
            
            console.log('Image clicked, contentEditable:', this.contentEditable);
            
            // 크기조절 모드 토글
            if (this.contentEditable === 'true') {
                // 크기조절 모드 해제
                this.style.cursor = 'pointer';
                this.contentEditable = 'false';
                this.style.border = '2px dashed transparent';
                this.style.resize = 'none';
                console.log('Resize mode disabled');
            } else {
                // 크기조절 모드 활성화
                this.style.cursor = 'nw-resize';
                this.contentEditable = 'true';
                this.style.border = '2px solid #3b82f6';
                this.style.resize = 'both';
                this.style.overflow = 'auto';
                console.log('Resize mode enabled');
                
                // 다른 곳 클릭 시 크기조절 모드 해제
                setTimeout(() => {
                    document.addEventListener('click', function removeResize() {
                        if (this.contentEditable === 'true') {
                            this.style.cursor = 'pointer';
                            this.contentEditable = 'false';
                            this.style.border = '2px dashed transparent';
                            this.style.resize = 'none';
                            console.log('Resize mode disabled by outside click');
                        }
                        document.removeEventListener('click', removeResize);
                    }.bind(this), { once: true });
                }, 100);
            }
        }
    </script>
</body>
</html> 